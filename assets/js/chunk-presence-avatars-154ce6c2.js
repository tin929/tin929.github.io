System.register(["./chunk-vendor.js","./chunk-frameworks.js"],(function(){"use strict";var t,e,s,a,r;return{setters:[function(a){t=a._,e=a.t,s=a.c},function(t){a=t.c,r=t.N}],execute:function(){const n={two:"AvatarStack--two",threePlus:"AvatarStack--three-plus"};let i=class PresenceAvatars extends HTMLElement{constructor(){super(...arguments),this.avatarsByUserId=new Map}connectedCallback(){const t=this.avatar.parentElement,e=this.avatar;if(e.hidden=!0,this.hidden=!1,!t)return;for(const a of Array.from(t.children))a!==e&&t.removeChild(a);this.classList.add("js-socket-channel");const s=s=>{const{userId:a,isOwnUser:n,isIdle:i}=s,c=r("PRESENCE_IDLE")&&i?"0.3":"1";let o=this.avatarsByUserId.get(a);o||(o=e.cloneNode(!0),o.src=o.src.replace(/u\/[0-9]+/,`u/${a}`),o.setAttribute("data-hovercard-url",`/hovercards?user_id=${a}`),o.hidden=!1,o.removeAttribute("data-target"),o.animate&&o.animate([{opacity:"0"},{opacity:c}],{duration:500,easing:"ease-in-out"}),n?t.appendChild(o):t.prepend(o)),o.style.transition="opacity 0.5s ease-in-out",o.style.opacity=c,this.avatarsByUserId.set(a,o)},i=e=>{const s=this.avatarsByUserId.get(e);s&&(null==t||t.removeChild(s),this.avatarsByUserId.delete(e))};this.subscription=a(this,"socket:presence",(e=>{const{data:a}=e.detail,r=this.avatarsByUserId.keys(),c=new Set;for(const t of a)s(t),c.add(t.userId);for(const t of r)c.has(t)||i(t);const o=t.parentElement;for(const t of Object.values(n))null==o||o.classList.remove(t);const d=this.avatarsByUserId.size;2===d?null==o||o.classList.add(n.two):d>2&&(null==o||o.classList.add(n.threePlus))}))}disconnectedCallback(){this.subscription&&this.subscription.unsubscribe()}};t([e],i.prototype,"avatar",void 0),i=t([s],i)}}}));
//# sourceMappingURL=chunk-presence-avatars-94ebc7d4.js.map
